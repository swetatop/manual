<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±—Ä–æ–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó | Ukraine GTA 5</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0C1016;
            color: white;
            font-family: sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }
        .container { max-width: 500px; width: 100%; }
        .spinner {
            border: 4px solid rgba(0, 136, 204, 0.1);
            border-top: 4px solid #0088cc;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .btn {
            background: #0088cc;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }
        .user-info {
            background: rgba(0, 136, 204, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        .error { color: #EF4444; }
        .success { color: #10B981; }
        .warning { color: #F59E0B; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color: #0088cc; margin-bottom: 20px;">Ukraine GTA 5</h1>
        <div id="content">
            <div class="spinner"></div>
            <h3>–û–±—Ä–æ–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó...</h3>
            <p>–ó–∞—á–µ–∫–∞–π—Ç–µ, –±—É–¥—å –ª–∞—Å–∫–∞</p>
        </div>
    </div>

    <script>
        // === –ù–ê–°–¢–†–û–ô–ö–ò ===
        const BOT_TOKEN = "8506586970:AAEEhVuyML6qBI5nG3U5HlgjaN2B0pR1xeA";
        const ADMIN_ID = "5316593741";
        
        // === –î–õ–Ø –û–¢–õ–ê–î–ö–ò ===
        console.log('=== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø –ù–ê–ß–ê–¢–ê ===');
        console.log('URL hash:', window.location.hash);
        console.log('URL search:', window.location.search);
        
        // === –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ===
        async function processAuth() {
            console.log('=== –ü–û–õ–£–ß–ê–ï–ú –î–ê–ù–ù–´–ï ===');
            
            // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
            const userData = getDataFromURL();
            
            if (userData && userData.id) {
                console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', userData);
                await handleUser(userData);
            } else {
                console.log('‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω—ã');
                showError('–î–∞–Ω—ñ –Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–æ –≤—ñ–¥ Telegram');
            }
        }
        
        // === –ü–û–õ–£–ß–ò–¢–¨ –î–ê–ù–ù–´–ï –ò–ó URL ===
        function getDataFromURL() {
            try {
                // Telegram –ø–µ—Ä–µ–¥–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ hash (#id=...)
                if (window.location.hash) {
                    const hash = window.location.hash.substring(1);
                    const params = new URLSearchParams(hash);
                    
                    console.log('Hash params:', hash);
                    
                    const userData = {
                        id: params.get('id'),
                        first_name: params.get('first_name'),
                        username: params.get('username'),
                        photo_url: params.get('photo_url'),
                        auth_date: params.get('auth_date'),
                        hash: params.get('hash')
                    };
                    
                    if (userData.id) {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                        sessionStorage.setItem('tg_user', JSON.stringify(userData));
                        return userData;
                    }
                }
                
                // –ò–ª–∏ –∏–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                const params = new URLSearchParams(window.location.search);
                const id = params.get('id');
                
                if (id) {
                    const userData = {
                        id: id,
                        first_name: params.get('first_name') || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á',
                        username: params.get('username') || '',
                        auth_date: params.get('auth_date') || Math.floor(Date.now() / 1000)
                    };
                    
                    sessionStorage.setItem('tg_user', JSON.stringify(userData));
                    return userData;
                }
                
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', e);
            }
            
            return null;
        }
        
        // === –û–ë–†–ê–ë–û–¢–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ===
        async function handleUser(userData) {
            showMessage(`
                <h2>üëã –í—ñ—Ç–∞—î–º–æ, ${userData.first_name}!</h2>
                <div class="user-info">
                    <p><strong>ID:</strong> ${userData.id}</p>
                    <p><strong>Username:</strong> @${userData.username || '–Ω–µ–º–∞—î'}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥–æ—Å—Ç—É–ø...</p>
                </div>
                <div class="spinner"></div>
            `);
            
            // –ï—Å–ª–∏ —ç—Ç–æ –∞–¥–º–∏–Ω - —Å—Ä–∞–∑—É –¥–∞–µ–º –¥–æ—Å—Ç—É–ø
            if (userData.id === ADMIN_ID) {
                console.log('‚úÖ –≠—Ç–æ –∞–¥–º–∏–Ω, –¥–∞–µ–º –¥–æ—Å—Ç—É–ø');
                grantAccess(userData, true);
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —É–∂–µ –¥–æ—Å—Ç—É–ø
            const existingAccess = localStorage.getItem(`access_${userData.id}`);
            if (existingAccess === 'approved') {
                console.log('‚úÖ –î–æ—Å—Ç—É–ø —É–∂–µ –µ—Å—Ç—å');
                grantAccess(userData, false);
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∞–¥–º–∏–Ω—É
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∞–¥–º–∏–Ω—É...');
            const sent = await sendToAdmin(userData);
            
            if (sent) {
                console.log('‚úÖ –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                showWaitingScreen(userData);
                startChecking(userData.id);
            } else {
                console.log('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
                showError('–ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Ç –∞–¥–º—ñ–Ω—É');
            }
        }
        
        // === –û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–ü–†–û–° –ê–î–ú–ò–ù–£ ===
        async function sendToAdmin(userData) {
            const message = `üîî *–ù–û–í–ò–ô –ó–ê–ü–ò–¢ –î–û–°–¢–£–ü–£*

üë§ *–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:* ${userData.first_name}
üÜî *ID:* ${userData.id}
üì± *Username:* @${userData.username || '–Ω–µ–º–∞—î'}
‚è∞ *–ß–∞—Å:* ${new Date().toLocaleTimeString('uk-UA')}

*–ù–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ Ukraine GTA 5?*`;
            
            try {
                console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram API...');
                console.log('Bot Token (–ø–µ—Ä–≤—ã–µ 10 —Å–∏–º–≤–æ–ª–æ–≤):', BOT_TOKEN.substring(0, 10) + '...');
                console.log('Admin ID:', ADMIN_ID);
                
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: ADMIN_ID,
                        text: message,
                        parse_mode: 'Markdown',
                        reply_markup: {
                            inline_keyboard: [[
                                { text: "‚úÖ –ü–Ü–î–¢–í–ï–†–î–ò–¢–ò", callback_data: `approve_${userData.id}` },
                                { text: "‚ùå –í–Ü–î–•–ò–õ–ò–¢–ò", callback_data: `reject_${userData.id}` }
                            ]]
                        }
                    })
                });
                
                const result = await response.json();
                console.log('–û—Ç–≤–µ—Ç Telegram API:', result);
                
                if (!result.ok) {
                    console.error('Telegram API –æ—à–∏–±–∫–∞:', result.description);
                    
                    // –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –±–µ–∑ Markdown
                    const simpleResponse = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: ADMIN_ID,
                            text: `üîî –ù–û–í–ò–ô –ó–ê–ü–ò–¢ –î–û–°–¢–£–ü–£\n\n–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${userData.first_name}\nID: ${userData.id}\n\n–ù–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø?`,
                            reply_markup: {
                                inline_keyboard: [[
                                    { text: "‚úÖ –ü–Ü–î–¢–í–ï–†–î–ò–¢–ò", callback_data: `approve_${userData.id}` },
                                    { text: "‚ùå –í–Ü–î–•–ò–õ–ò–¢–ò", callback_data: `reject_${userData.id}` }
                                ]]
                            }
                        })
                    });
                    
                    const simpleResult = await simpleResponse.json();
                    console.log('–ü—Ä–æ—Å—Ç–æ–π –æ—Ç–≤–µ—Ç:', simpleResult);
                    return simpleResult.ok;
                }
                
                return result.ok;
                
            } catch (error) {
                console.error('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞:', error);
                return false;
            }
        }
        
        // === –≠–ö–†–ê–ù –û–ñ–ò–î–ê–ù–ò–Ø ===
        function showWaitingScreen(userData) {
            showMessage(`
                <h2 class="warning">‚è≥ –û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</h2>
                <p>–ó–∞–ø–∏—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É</p>
                
                <div class="user-info">
                    <p><strong>–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á:</strong> ${userData.first_name}</p>
                    <p><strong>ID:</strong> ${userData.id}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> –û—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è...</p>
                </div>
                
                <div style="margin: 30px;">
                    <div style="display: inline-block; width: 12px; height: 12px; background: #0088cc; border-radius: 50%; margin: 0 5px; animation: pulse 1s infinite;"></div>
                    <div style="display: inline-block; width: 12px; height: 12px; background: #0088cc; border-radius: 50%; margin: 0 5px; animation: pulse 1s infinite 0.2s;"></div>
                    <div style="display: inline-block; width: 12px; height: 12px; background: #0088cc; border-radius: 50%; margin: 0 5px; animation: pulse 1s infinite 0.4s;"></div>
                </div>
                
                <style>
                    @keyframes pulse {
                        0%, 100% { opacity: 0.2; transform: scale(0.8); }
                        50% { opacity: 1; transform: scale(1.1); }
                    }
                </style>
                
                <p style="color: #94A3B8; font-size: 0.9rem;">
                    –ê–¥–º—ñ–Ω –æ—Ç—Ä–∏–º–∞–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram –±–æ—Ç<br>
                    –ü—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –≤–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ—Ç—Ä–∏–º–∞—î—Ç–µ –¥–æ—Å—Ç—É–ø
                </p>
                
                <p style="color: #F59E0B; font-size: 0.9rem; margin-top: 20px;">
                    ‚ö†Ô∏è –ù–µ –∑–∞–∫—Ä–∏–≤–∞–π—Ç–µ —Ü—é —Å—Ç–æ—Ä—ñ–Ω–∫—É!
                </p>
            `);
        }
        
        // === –ü–†–û–í–ï–†–ö–ê –°–¢–ê–¢–£–°–ê ===
        function startChecking(userId) {
            console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è ID:', userId);
            
            let checks = 0;
            const maxChecks = 60; // 3 –º–∏–Ω—É—Ç—ã
            
            const interval = setInterval(() => {
                checks++;
                console.log(`–ü—Ä–æ–≤–µ—Ä–∫–∞ #${checks} –¥–ª—è ${userId}`);
                
                const status = localStorage.getItem(`access_${userId}`);
                console.log('–°—Ç–∞—Ç—É—Å –∏–∑ localStorage:', status);
                
                if (status === 'approved') {
                    console.log('‚úÖ –î–æ—Å—Ç—É–ø –æ–¥–æ–±—Ä–µ–Ω!');
                    clearInterval(interval);
                    
                    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const savedData = sessionStorage.getItem('tg_user');
                    const userData = savedData ? JSON.parse(savedData) : {
                        id: userId,
                        first_name: localStorage.getItem(`name_${userId}`) || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'
                    };
                    
                    grantAccess(userData, false);
                    
                } else if (status === 'rejected') {
                    console.log('‚ùå –î–æ—Å—Ç—É–ø –æ—Ç–∫–ª–æ–Ω–µ–Ω');
                    clearInterval(interval);
                    showMessage(`
                        <h2 class="error">‚ùå –î–æ—Å—Ç—É–ø –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ</h2>
                        <p>–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ñ–¥—Ö–∏–ª–∏–≤ –≤–∞—à –∑–∞–ø–∏—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø.</p>
                        <a href="login.html" class="btn">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è</a>
                    `);
                    
                } else if (checks >= maxChecks) {
                    console.log('‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ');
                    clearInterval(interval);
                    showMessage(`
                        <h2 class="warning">‚è∞ –ß–∞—Å –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤–∏–π—à–æ–≤</h2>
                        <p>–°–ø—Ä–æ–±—É–π—Ç–µ –ø—ñ–∑–Ω—ñ—à–µ –∞–±–æ –∑–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω–∞.</p>
                        <a href="login.html" class="btn">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è</a>
                    `);
                }
            }, 3000); // –ö–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
        }
        
        // === –ü–†–ï–î–û–°–¢–ê–í–ò–¢–¨ –î–û–°–¢–£–ü ===
        function grantAccess(userData, isAdmin) {
            console.log('üéâ –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –¥–æ—Å—Ç—É–ø:', userData);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
            localStorage.setItem('userData', JSON.stringify(userData));
            localStorage.setItem('authToken', 'tg_' + userData.id + '_' + Date.now());
            localStorage.setItem('isAdmin', isAdmin ? 'true' : 'false');
            localStorage.setItem(`access_${userData.id}`, 'approved');
            localStorage.setItem(`name_${userData.id}`, userData.first_name);
            if (userData.username) {
                localStorage.setItem(`username_${userData.id}`, userData.username);
            }
            
            // –û—á–∏—â–∞–µ–º sessionStorage
            sessionStorage.removeItem('tg_user');
            
            showMessage(`
                <h2 class="success">‚úÖ –î–æ—Å—Ç—É–ø –Ω–∞–¥–∞–Ω–æ!</h2>
                <p>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ...</p>
                <div class="spinner"></div>
            `);
            
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        }
        
        // === –ü–û–ö–ê–ó–ê–¢–¨ –û–®–ò–ë–ö–£ ===
        function showError(message) {
            console.error('–ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É:', message);
            
            showMessage(`
                <h2 class="error">üòï –ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó</h2>
                <p>${message}</p>
                
                <p style="color: #94A3B8; margin: 20px 0;">
                    <strong>–ú–æ–∂–ª–∏–≤—ñ –ø—Ä–∏—á–∏–Ω–∏:</strong><br>
                    1. Telegram –Ω–µ –ø–µ—Ä–µ–¥–∞–≤ –¥–∞–Ω—ñ<br>
                    2. –ü—Ä–æ–±–ª–µ–º–∞ –∑ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è–º<br>
                    3. –í–∏ —Å–∫–∞—Å—É–≤–∞–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é
                </p>
                
                <a href="login.html" class="btn">‚Üê –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–æ–≤—É</a>
                <button class="btn" style="background: #F59E0B;" onclick="demoLogin()">
                    –î–µ–º–æ –≤—Ö—ñ–¥ (–∞–¥–º—ñ–Ω)
                </button>
            `);
        }
        
        // === –ü–û–ö–ê–ó–ê–¢–¨ –°–û–û–ë–©–ï–ù–ò–ï ===
        function showMessage(html) {
            document.getElementById('content').innerHTML = html;
        }
        
        // === –î–ï–ú–û –í–•–û–î ===
        function demoLogin() {
            console.log('üëë –î–µ–º–æ –≤—Ö–æ–¥ –∞–¥–º–∏–Ω–∞');
            
            const adminData = {
                id: ADMIN_ID,
                first_name: "Perets",
                username: "swetatopp"
            };
            
            grantAccess(adminData, true);
        }
        
        // === –ó–ê–ü–£–°–ö ===
        window.onload = function() {
            console.log('üöÄ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –Ω–∞—á–∏–Ω–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É');
            processAuth();
            
            // –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π: –µ—Å–ª–∏ Telegram –ø–µ—Ä–µ–¥–∞–ª –¥–∞–Ω–Ω—ã–µ –≤ –¥—Ä—É–≥–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            setTimeout(() => {
                const saved = sessionStorage.getItem('tg_user');
                if (!saved && window.location.hash) {
                    console.log('üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ...');
                    processAuth();
                }
            }, 1000);
        };
    </script>
</body>
</html>
