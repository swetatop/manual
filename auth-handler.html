<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Авторизація | Ukraine GTA 5</title>
    <style>* { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #0C1016; color: white; font-family: sans-serif; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; text-align: center; }
        .container { max-width: 500px; width: 100%; }
        .spinner { border: 4px solid rgba(0, 136, 204, 0.1); border-top: 4px solid #0088cc; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .btn { background: #0088cc; color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 10px; text-decoration: none; display: inline-block; transition: all 0.3s ease; }
        .btn:hover { background: #0077b5; transform: translateY(-2px); }
        .btn-success { background: #10B981; } .btn-success:hover { background: #059669; }
        .btn-warning { background: #F59E0B; } .btn-warning:hover { background: #D97706; }
        .btn-dark { background: #2D3748; } .btn-dark:hover { background: #1E293B; }
        .user-info { background: rgba(0, 136, 204, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0; text-align: left; }
        .success { color: #10B981; } .warning { color: #F59E0B; } .error { color: #EF4444; }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="color: #0088cc; margin-bottom: 20px;">Ukraine GTA 5</h1>
        <div id="content"><div class="spinner"></div><h3>Обробка авторизації...</h3></div>
    </div>

    <script type="module">
        import { db, ADMIN_ID, BOT_TOKEN } from './firebase-app.js';
        import { doc, getDoc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
        
        // РЕАЛЬНЫЙ РЕЖИМ - никаких тестов!
        const TEST_MODE = false;
        
        async function processAuth() {
            // Получаем реальные данные из Telegram
            const userData = getTelegramData();
            
            if (!userData?.id) {
                showError('Не вдалося отримати дані з Telegram.<br><br>Будь ласка:<br>1. Відкрийте сторінку через бота @UGgtavBot<br>2. Або натисніть "Увійти через Telegram" на головній сторінці<br><br><a href="login.html" style="color:#0088cc;">← Повернутися до входу</a>');
                return;
            }
            
            await processUserData(userData);
        }
        
        // Получение данных из Telegram Widget
        function getTelegramData() {
            try {
                const hash = window.location.hash.substring(1);
                if (!hash) return null;
                
                const params = new URLSearchParams(hash);
                const id = params.get('id');
                if (!id) return null;
                
                return {
                    id: id,
                    first_name: params.get('first_name') || 'Користувач',
                    username: params.get('username') || '',
                    photo_url: params.get('photo_url') || ''
                };
                
            } catch (e) {
                console.error('Помилка отримання даних:', e);
                return null;
            }
        }
        
        async function processUserData(userData) {
            // Если это админ - сразу даем доступ
            if (userData.id === ADMIN_ID.toString()) {
                await saveUser(userData, true);
                grantAccess(userData, true);
                return;
            }
            
            // Проверяем статус пользователя
            await checkUserAccess(userData);
        }
        
        async function checkUserAccess(userData) {
            try {
                const userDoc = await getDoc(d
