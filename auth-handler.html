<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è | Ukraine GTA 5</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background: #0f1419;
            color: white;
            font-family: sans-serif;
            padding: 50px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        
        .container {
            max-width: 500px;
            width: 100%;
            background: #1a2029;
            padding: 40px;
            border-radius: 20px;
            border: 1px solid #2D3748;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #3B82F6;
        }
        
        .user-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-info {
            margin: 15px 0;
        }
        
        .user-info div {
            margin: 12px 0;
            display: flex;
            justify-content: space-between;
        }
        
        .user-info strong {
            color: #94A3B8;
        }
        
        .user-info span {
            color: #E2E8F0;
            font-weight: 500;
        }
        
        .status-box {
            padding: 20px;
            border-radius: 12px;
            margin: 25px 0;
            text-align: center;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }
        
        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid #F59E0B;
            color: #F59E0B;
        }
        
        .status-approved {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid #10B981;
            color: #10B981;
        }
        
        .status-rejected {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #EF4444;
            color: #EF4444;
        }
        
        .buttons {
            display: flex;
            gap: 20px;
            margin-top: 40px;
        }
        
        .btn {
            flex: 1;
            padding: 18px;
            border-radius: 12px;
            border: none;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .btn-approve {
            background: #10B981;
            color: white;
        }
        
        .btn-reject {
            background: #EF4444;
            color: white;
        }
        
        .btn-approve:hover, .btn-reject:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .admin-info {
            background: rgba(139, 92, 246, 0.1);
            border-left: 4px solid #8B5CF6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
            color: #94A3B8;
        }
        
        .admin-info strong {
            color: #8B5CF6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-user-check"></i> –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –¥–æ—Å—Ç—É–ø—É</h1>
        
        <div class="user-card">
            <h3 style="margin-bottom: 20px; color: #E2E8F0;">
                <i class="fas fa-user"></i> –î–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
            </h3>
            
            <div class="user-info">
                <div>
                    <strong>Telegram ID:</strong>
                    <span id="userId">...</span>
                </div>
                <div>
                    <strong>–Ü–º'—è:</strong>
                    <span id="userName">...</span>
                </div>
                <div>
                    <strong>–õ–æ–≥—ñ–Ω:</strong>
                    <span id="userLogin">...</span>
                </div>
                <div>
                    <strong>–î–∞—Ç–∞ –∑–∞–ø–∏—Ç—É:</strong>
                    <span id="authDate">...</span>
                </div>
            </div>
        </div>
        
        <!-- –ë–ª–æ–∫ –¥–ª—è –∞–¥–º–∏–Ω–∞ -->
        <div class="admin-info" id="adminInfo" style="display: none;">
            <i class="fas fa-crown"></i> <strong>–í–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</strong> - –≤–∏ –º–æ–∂–µ—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
        </div>
        
        <!-- –°—Ç–∞—Ç—É—Å -->
        <div class="status-box status-pending" id="statusBox">
            <i class="fas fa-clock"></i>
            <span id="statusText">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</span>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ -->
        <div class="buttons" id="buttons">
            <button class="btn btn-approve" id="approveBtn">
                <i class="fas fa-check"></i> ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏
            </button>
            <button class="btn btn-reject" id="rejectBtn">
                <i class="fas fa-times"></i> ‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏
            </button>
        </div>
    </div>
    
    <!-- Firebase -->
    <script type="module" src="firebase-app.js"></script>
    <script type="module">
        import { db } from './firebase-app.js';
        import { doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
        const params = new URLSearchParams(window.location.search);
        const userId = params.get('user_id');
        const userName = params.get('user_name');
        const userLogin = params.get('user_login');
        const authDate = params.get('auth_date');
        
        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const userIdEl = document.getElementById('userId');
        const userNameEl = document.getElementById('userName');
        const userLoginEl = document.getElementById('userLogin');
        const authDateEl = document.getElementById('authDate');
        const statusBox = document.getElementById('statusBox');
        const statusText = document.getElementById('statusText');
        const buttons = document.getElementById('buttons');
        const adminInfo = document.getElementById('adminInfo');
        const approveBtn = document.getElementById('approveBtn');
        const rejectBtn = document.getElementById('rejectBtn');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        userIdEl.textContent = userId || '–ù–µ–º–∞—î';
        userNameEl.textContent = decodeURIComponent(userName || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á');
        userLoginEl.textContent = userLogin ? '@' + userLogin : '–ù–µ–º–∞—î';
        authDateEl.textContent = authDate ? 
            new Date(parseInt(authDate) * 1000).toLocaleString('uk-UA') : '–ù–µ–≤—ñ–¥–æ–º–æ';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–¥–º–∏–Ω –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        async function checkIfAdmin() {
            console.log('üëë –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞...');
            
            const savedUser = localStorage.getItem('telegram_user');
            
            if (!savedUser) {
                console.log('‚ùå –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ localStorage');
                return false;
            }
            
            try {
                const userData = JSON.parse(savedUser);
                const currentUserId = userData.id;
                
                // –ï—Å–ª–∏ —ç—Ç–æ —Ç—ã (ID: 5316593741) - –∞–¥–º–∏–Ω
                if (currentUserId === '5316593741') {
                    console.log('‚úÖ –≠—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∞–¥–º–∏–Ω');
                    adminInfo.style.display = 'block';
                    return true;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤ Firebase
                const userDoc = await getDoc(doc(db, "users", currentUserId));
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    if (userData.isAdmin) {
                        adminInfo.style.display = 'block';
                        return true;
                    }
                }
                
                return false;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–º–∏–Ω–∞:', error);
                return false;
            }
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function checkUserStatus() {
            if (!userId) {
                showError('‚ùå –ù–µ–º–∞—î ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞');
                return;
            }
            
            try {
                const userDoc = await getDoc(doc(db, "users", userId));
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    const status = userData.status || 'pending';
                    
                    updateStatus(status);
                    
                    // –ï—Å–ª–∏ —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
                    if (status === 'approved') {
                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                        const userDataForStorage = {
                            id: userId,
                            first_name: decodeURIComponent(userName || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'),
                            username: userLogin || '',
                            auth_date: authDate ? parseInt(authDate) : Date.now()
                        };
                        
                        localStorage.setItem('telegram_user', JSON.stringify(userDataForStorage));
                        localStorage.setItem('auth_time', Date.now().toString());
                        
                        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
                        setTimeout(() => {
                            window.location.href = 'index.html';
                        }, 3000);
                    }
                    
                } else {
                    // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —Å–æ—Ö—Ä–∞–Ω—è–µ–º
                    await setDoc(doc(db, "users", userId), {
                        telegram_id: userId,
                        name: decodeURIComponent(userName || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'),
                        username: userLogin || '',
                        status: 'pending',
                        created_at: new Date(),
                        auth_date: authDate ? parseInt(authDate) : Date.now()
                    });
                    
                    updateStatus('pending');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å—É');
            }
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
        function updateStatus(status) {
            switch (status) {
                case 'pending':
                    statusBox.className = 'status-box status-pending';
                    statusText.innerHTML = '<i class="fas fa-clock"></i> –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –æ—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è';
                    break;
                    
                case 'approved':
                    statusBox.className = 'status-box status-approved';
                    statusText.innerHTML = '<i class="fas fa-check-circle"></i> ‚úÖ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∂–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏–π';
                    buttons.style.display = 'none';
                    break;
                    
                case 'rejected':
                    statusBox.className = 'status-box status-rejected';
                    statusText.innerHTML = '<i class="fas fa-times-circle"></i> ‚ùå –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤—ñ–¥—Ö–∏–ª–µ–Ω–∏–π';
                    buttons.style.display = 'none';
                    break;
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
        function showError(message) {
            statusBox.className = 'status-box status-rejected';
            statusText.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            buttons.style.display = 'none';
        }
        
        // –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function approveUser() {
            if (!userId) return;
            
            try {
                await updateDoc(doc(db, "users", userId), {
                    status: 'approved',
                    approved_at: new Date(),
                    approved_by: 'admin_from_site'
                });
                
                console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω:', userId);
                
                updateStatus('approved');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const userData = {
                    id: userId,
                    first_name: decodeURIComponent(userName || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'),
                    username: userLogin || '',
                    auth_date: authDate ? parseInt(authDate) : Date.now()
                };
                
                localStorage.setItem('telegram_user', JSON.stringify(userData));
                localStorage.setItem('auth_time', Date.now().toString());
                
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:', error);
                alert('‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞');
            }
        }
        
        // –û—Ç–∫–ª–æ–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function rejectUser() {
            if (!userId) return;
            
            if (!confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ —Ü—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞?')) {
                return;
            }
            
            try {
                await updateDoc(doc(db, "users", userId), {
                    status: 'rejected',
                    rejected_at: new Date(),
                    rejected_by: 'admin_from_site'
                });
                
                updateStatus('rejected');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è:', error);
                alert('‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –≤—ñ–¥—Ö–∏–ª–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è auth-handler...');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–¥–º–∏–Ω –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            const isAdmin = await checkIfAdmin();
            
            // –ï—Å–ª–∏ –Ω–µ –∞–¥–º–∏–Ω –∏ —ç—Ç–æ –Ω–µ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            if (!isAdmin) {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —ç—Ç–æ —Ç–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á—Ç–æ –≤ localStorage?
                const savedUser = localStorage.getItem('telegram_user');
                if (savedUser) {
                    const currentUser = JSON.parse(savedUser);
                    if (currentUser.id === userId) {
                        // –≠—Ç–æ —Ç–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç—É—Å
                        console.log('‚ÑπÔ∏è –≠—Ç–æ —Ç–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å');
                        buttons.style.display = 'none';
                    } else {
                        // –≠—Ç–æ –Ω–µ –∞–¥–º–∏–Ω –∏ –Ω–µ —Ç–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
                        showError('‚ùå –î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ. –¢—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ –º–æ–∂—É—Ç—å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É–≤–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤.');
                        return;
                    }
                } else {
                    // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
                    showError('‚ùå –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–ø–æ—á–∞—Ç–∫—É —É–≤—ñ–π–¥—ñ—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É.');
                    return;
                }
            }
            
            // –ï—Å–ª–∏ –∞–¥–º–∏–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏
            if (isAdmin) {
                approveBtn.addEventListener('click', approveUser);
                rejectBtn.addEventListener('click', rejectUser);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            await checkUserStatus();
            
            console.log('‚úÖ Auth-handler –≥–æ—Ç–æ–≤');
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
