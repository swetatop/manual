<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webhook Handler | Ukraine GTA 5</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            padding: 20px;
            text-align: center;
        }
        .container {
            max-width: 800px;
            margin: 50px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1 { color: #0088cc; margin-bottom: 20px; }
        .status {
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            font-size: 1.1rem;
        }
        .success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
        .error { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        .info { background: #dbeafe; color: #1e40af; border: 1px solid #bfdbfe; }
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            margin: 20px 0;
            overflow-x: auto;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üåê Webhook Handler</h1>
        <p>–¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –æ–±—Ä–æ–±–ª—è—î –∑–∞–ø–∏—Ç–∏ –≤—ñ–¥ Telegram –±–æ—Ç–∞</p>
        
        <div id="result" class="status info">
            <i class="fas fa-spinner fa-spin"></i> –û–±—Ä–æ–±–∫–∞ –∑–∞–ø–∏—Ç—É...
        </div>
        
        <pre id="dataDisplay">–î–∞–Ω—ñ –±—É–¥—É—Ç—å –ø–æ–∫–∞–∑–∞–Ω—ñ —Ç—É—Ç...</pre>
    </div>

    <script>
        // –¢–æ–∫–µ–Ω –±–æ—Ç–∞
        const BOT_TOKEN = "8506586970:AAEEhVuyML6qBI5nG3U5HlgjaN2B0pR1xeA";
        const ADMIN_CHAT_ID = "5316593741";
        
        async function processWebhook() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ URL
                const urlParams = new URLSearchParams(window.location.search);
                const callbackData = urlParams.get('callback_data');
                
                if (!callbackData) {
                    document.getElementById('result').innerHTML = `
                        <div class="error">
                            <i class="fas fa-exclamation-triangle"></i>
                            –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –æ–±—Ä–æ–±–∫–∏
                        </div>
                    `;
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
                document.getElementById('dataDisplay').textContent = 
                    `Callback data: ${callbackData}\n\n` +
                    `Full URL: ${window.location.href}`;
                
                // –†–∞–∑–±–∏—Ä–∞–µ–º callback_data
                // –§–æ—Ä–º–∞—Ç: action_userId_timestamp
                const parts = callbackData.split('_');
                const action = parts[0]; // 'approve' –∏–ª–∏ 'reject'
                const userId = parts[1];
                const timestamp = parts[2];
                
                console.log(`–û–±—Ä–æ–±–∫–∞: ${action} –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${userId}`);
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ localStorage (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ - –≤ –±–∞–∑—É)
                localStorage.setItem(`access_${userId}`, action === 'approve' ? 'approved' : 'rejected');
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
                if (action === 'approve') {
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ–ª—É—á–∏–º –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞)
                    const userName = urlParams.get('name') || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á';
                    localStorage.setItem(`name_${userId}`, userName);
                    
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, —á—Ç–æ –¥–æ—Å—Ç—É–ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
                    await sendNotification(userId, 'approved');
                    
                    document.getElementById('result').innerHTML = `
                        <div class="success">
                            <i class="fas fa-check-circle"></i>
                            ‚úÖ –î–æ—Å—Ç—É–ø –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${userId}
                        </div>
                    `;
                    
                } else if (action === 'reject') {
                    await sendNotification(userId, 'rejected');
                    
                    document.getElementById('result').innerHTML = `
                        <div class="error">
                            <i class="fas fa-ban"></i>
                            ‚ùå –î–æ—Å—Ç—É–ø –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ –¥–ª—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ${userId}
                        </div>
                    `;
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –≤ Telegram (callback answer)
                await answerCallback(callbackData);
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏:', error);
                document.getElementById('result').innerHTML = `
                    <div class="error">
                        <i class="fas fa-exclamation-triangle"></i>
                        –ü–æ–º–∏–ª–∫–∞: ${error.message}
                    </div>
                `;
            }
        }
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
        async function sendNotification(userId, status) {
            try {
                const message = status === 'approved' 
                    ? `üéâ –í–∞—à –¥–æ—Å—Ç—É–ø –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ Ukraine GTA 5 –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ!\n\n–í–∏ –º–æ–∂–µ—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—Ö–æ–¥—É.`
                    : `‚ùå –í–∞—à –∑–∞–ø–∏—Ç –Ω–∞ –¥–æ—Å—Ç—É–ø –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ Ukraine GTA 5 –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ.\n\n–ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó.`;
                
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: userId,
                        text: message,
                        parse_mode: 'Markdown'
                    })
                });
                
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è:', error);
            }
        }
        
        // –û—Ç–≤–µ—Ç –Ω–∞ callback –≤ Telegram
        async function answerCallback(callbackData) {
            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/answerCallbackQuery`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        callback_query_id: callbackData,
                        text: "–î—ñ—è –≤–∏–∫–æ–Ω–∞–Ω–∞ —É—Å–ø—ñ—à–Ω–æ!",
                        show_alert: false
                    })
                });
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ callback:', error);
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = processWebhook;
    </script>
    
    <!-- Font Awesome –¥–ª—è –∏–∫–æ–Ω–æ–∫ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</body>
</html>
