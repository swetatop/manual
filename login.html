<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û–±—Ä–æ–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó | Ukraine GTA 5</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0C1016;
            color: white;
            font-family: sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }
        .container {
            max-width: 500px;
            width: 100%;
        }
        .btn {
            background: #0088cc;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 20px;
            text-decoration: none;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container" id="container">
        <h1 style="color: #0088cc;">Ukraine GTA 5</h1>
        <div id="message">
            <h3>–û–±—Ä–æ–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó...</h3>
        </div>
    </div>

    <script>
        const BOT_TOKEN = "8506586970:AAEEhVuyML6qBI5nG3U5HlgjaN2B0pR1xeA";
        const ADMIN_ID = "5316593741";
        
        async function processAuth() {
            console.log('=== –û–ë–†–û–ë–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–Ü–á ===');
            
            // 1. –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
            let userData = null;
            const savedData = localStorage.getItem('telegramAuthData');
            
            if (savedData) {
                try {
                    userData = JSON.parse(savedData);
                    console.log('–î–∞–Ω—ñ –∑ localStorage:', userData);
                } catch (e) {
                    console.error('–ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É:', e);
                }
            }
            
            // 2. –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –∏–∑ URL
            if (!userData) {
                const urlParams = new URLSearchParams(window.location.search);
                const tgUser = urlParams.get('tg_user');
                
                if (tgUser) {
                    try {
                        userData = JSON.parse(decodeURIComponent(tgUser));
                        console.log('–î–∞–Ω—ñ –∑ URL:', userData);
                    } catch (e) {
                        console.error('–ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É URL:', e);
                    }
                }
            }
            
            // 3. –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º
            if (userData && userData.id) {
                await handleUser(userData);
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤–≤–æ–¥–∞
                showInputForm();
            }
        }
        
        async function handleUser(userData) {
            // –ï—Å–ª–∏ —ç—Ç–æ –∞–¥–º–∏–Ω - —Å—Ä–∞–∑—É –¥–æ—Å—Ç—É–ø
            if (userData.id === ADMIN_ID) {
                grantAccess(userData);
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å–ª–∏ —É–∂–µ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø
            const existingAccess = localStorage.getItem(`access_${userData.id}`);
            if (existingAccess === 'approved') {
                grantAccess(userData);
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∞–¥–º–∏–Ω—É
            await sendRequestToAdmin(userData);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–∂–∏–¥–∞–Ω–∏–µ
            showWaitingScreen(userData);
            
            // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É
            startChecking(userData.id);
        }
        
        async function sendRequestToAdmin(userData) {
            const message = `üîî –ù–û–í–ò–ô –ó–ê–ü–ò–¢ –î–û–°–¢–£–ü–£
            
üë§ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á: ${userData.first_name}
üÜî ID: ${userData.id}
üì± Username: @${userData.username || '–Ω–µ–º–∞—î'}
            
–ù–∞–¥–∞—Ç–∏ –¥–æ—Å—Ç—É–ø?`;
            
            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: ADMIN_ID,
                        text: message,
                        reply_markup: {
                            inline_keyboard: [[
                                {text: "‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏", callback_data: `approve_${userData.id}`},
                                {text: "‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏", callback_data: `reject_${userData.id}`}
                            ]]
                        }
                    })
                });
                console.log('–ó–∞–ø–∏—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º—ñ–Ω—É');
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏:', error);
            }
        }
        
        function showWaitingScreen(userData) {
            document.getElementById('message').innerHTML = `
                <h2>–û—á—ñ–∫—É–π—Ç–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</h2>
                <p>–ó–∞–ø–∏—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—É</p>
                <p><strong>${userData.first_name}</strong> (ID: ${userData.id})</p>
                <p>–ê–¥–º—ñ–Ω –æ—Ç—Ä–∏–º–∞–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ Telegram</p>
                <div style="margin: 20px;">
                    <div style="display: inline-block; width: 10px; height: 10px; background: #0088cc; border-radius: 50%; margin: 0 5px; animation: blink 1s infinite;"></div>
                    <div style="display: inline-block; width: 10px; height: 10px; background: #0088cc; border-radius: 50%; margin: 0 5px; animation: blink 1s infinite 0.2s;"></div>
                    <div style="display: inline-block; width: 10px; height: 10px; background: #0088cc; border-radius: 50%; margin: 0 5px; animation: blink 1s infinite 0.4s;"></div>
                </div>
                <style>@keyframes blink { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }</style>
            `;
        }
        
        function startChecking(userId) {
            const checkInterval = setInterval(() => {
                const status = localStorage.getItem(`access_${userId}`);
                
                if (status === 'approved') {
                    clearInterval(checkInterval);
                    grantAccess({id: userId, first_name: localStorage.getItem(`name_${userId}`) || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'});
                } else if (status === 'rejected') {
                    clearInterval(checkInterval);
                    showRejected();
                }
            }, 3000);
        }
        
        function grantAccess(userData) {
            localStorage.setItem('userData', JSON.stringify(userData));
            localStorage.setItem('authToken', 'tg_' + Date.now());
            localStorage.setItem(`access_${userData.id}`, 'approved');
            localStorage.setItem(`name_${userData.id}`, userData.first_name);
            
            document.getElementById('message').innerHTML = `
                <h2 style="color: #10B981;">–î–æ—Å—Ç—É–ø –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ! üéâ</h2>
                <p>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î–º–æ –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ...</p>
            `;
            
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        }
        
        function showRejected() {
            document.getElementById('message').innerHTML = `
                <h2 style="color: #EF4444;">–î–æ—Å—Ç—É–ø –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ</h2>
                <p>–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –≤—ñ–¥—Ö–∏–ª–∏–≤ –≤–∞—à –∑–∞–ø–∏—Ç</p>
                <a href="login.html" class="btn">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è</a>
            `;
        }
        
        function showInputForm() {
            document.getElementById('message').innerHTML = `
                <h3>–í–≤–µ–¥—ñ—Ç—å –≤–∞—à Telegram ID</h3>
                <input type="text" id="userId" placeholder="123456789" style="padding: 10px; width: 200px; margin: 10px;">
                <br>
                <button onclick="submitUserId()" class="btn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–ø–∏—Ç</button>
                <p style="margin-top: 20px; color: #aaa;">ID –º–æ–∂–Ω–∞ –¥—ñ–∑–Ω–∞—Ç–∏—Å—å —É @userinfobot</p>
            `;
        }
        
        function submitUserId() {
            const userId = document.getElementById('userId').value;
            if (!userId) return;
            
            const userData = {
                id: userId,
                first_name: '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'
            };
            
            handleUser(userData);
        }
        
        window.onload = processAuth;
    </script>
</body>
</html>
