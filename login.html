<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö—ñ–¥ –¥–æ –ø–æ—Å—ñ–±–Ω–∏–∫–∞ | Ukraine GTA 5</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3B82F6;
            --primary-dark: #2563EB;
            --bg-dark: #0f1419;
            --bg-card: #1a2029;
            --text-light: #F8FAFC;
            --text-gray: #94A3B8;
            --border: #2D3748;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: var(--bg-dark);
            color: var(--text-light);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            max-width: 450px;
            width: 100%;
            background: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            border: 1px solid var(--border);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), #8B5CF6);
            border-radius: 50%;
            margin: 0 auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 15px;
            background: linear-gradient(90deg, var(--primary), #60A5FA);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: var(--text-gray);
            font-size: 16px;
            line-height: 1.6;
            margin-bottom: 40px;
        }
        
        .login-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 30px;
        }
        
        .login-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }
        
        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(59, 130, 246, 0.4);
        }
        
        .login-btn:active {
            transform: translateY(-1px);
        }
        
        .login-btn i {
            font-size: 22px;
        }
        
        .loading {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(59, 130, 246, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .features {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 40px;
            text-align: left;
        }
        
        .feature {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-gray);
            font-size: 14px;
        }
        
        .feature i {
            color: var(--primary);
            font-size: 16px;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
            color: var(--text-gray);
            font-size: 14px;
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #FCA5A5;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: none;
        }
        
        .debug-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            font-size: 12px;
            color: var(--text-gray);
            text-align: left;
            display: none;
        }
        
        .debug-toggle {
            background: none;
            border: none;
            color: var(--primary);
            font-size: 12px;
            cursor: pointer;
            margin-top: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <i class="fas fa-shield-alt"></i>
        </div>
        
        <h1>Ukraine GTA 5</h1>
        <p class="subtitle">
            –í—Ö—ñ–¥ –¥–æ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—ñ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ñ–≤ —Å–µ—Ä–≤–µ—Ä–∞. 
            –î–ª—è –¥–æ—Å—Ç—É–ø—É –ø–æ—Ç—Ä—ñ–±–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Telegram.
        </p>
        
        <div class="login-card">
            <div id="telegramLoginWidget"></div>
            
            <button class="login-btn" id="manualLoginBtn">
                <i class="fab fa-telegram"></i> –£–≤—ñ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram
            </button>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è...</p>
            </div>
            
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="errorText">–ü–æ–º–∏–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó</span>
            </div>
        </div>
        
        <div class="features">
            <div class="feature">
                <i class="fas fa-check-circle"></i>
                <span>–ë–µ–∑–ø–µ—á–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ Telegram</span>
            </div>
            <div class="feature">
                <i class="fas fa-user-shield"></i>
                <span>–î–æ—Å—Ç—É–ø —Ç—ñ–ª—å–∫–∏ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–∏—Ö –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ñ–≤</span>
            </div>
            <div class="feature">
                <i class="fas fa-book"></i>
                <span>–ü–æ–≤–Ω–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –∑ –ø—Ä–∞–≤–∏–ª —Ç–∞ –∫–æ–º–∞–Ω–¥</span>
            </div>
        </div>
        
        <div class="footer">
            <p>Ukraine GTA 5 ¬© 2024 ‚Ä¢ –ê–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ñ–≤</p>
        </div>
        
        <button class="debug-toggle" id="debugToggle">–ü–æ–∫–∞–∑–∞—Ç–∏ —Ç–µ—Ö–Ω—ñ—á–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é</button>
        
        <div class="debug-info" id="debugInfo">
            <p><strong>–ü–æ—Ç–æ—á–Ω–∏–π URL:</strong> <span id="currentUrl"></span></p>
            <p><strong>Telegram Widget –¥–æ—Å—Ç—É–ø–Ω–∏–π:</strong> <span id="widgetStatus">–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞...</span></p>
            <p><strong>LocalStorage:</strong> <span id="storageStatus">–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞...</span></p>
            <button class="debug-toggle" onclick="clearLocalStorage()">–û—á–∏—Å—Ç–∏—Ç–∏ localStorage</button>
        </div>
    </div>
    
    <!-- Telegram Widget -->
    <script async src="https://telegram.org/js/telegram-widget.js?22" 
            data-telegram-login="UGgtavBot" 
            data-size="large" 
            data-radius="12"
            data-request-access="write"
            data-userpic="false"
            data-auth-url="https://swetatop.github.io/manual/login.html"
            data-lang="uk"></script>
    
    <script>
        // ========== –ù–ê–°–¢–†–û–ô–ö–ò ==========
        const BOT_USERNAME = 'UGgtavBot';
        const ADMIN_ID = '5316593741'; // –¢–≤–æ–π ID
        
        // ========== –≠–õ–ï–ú–ï–ù–¢–´ ==========
        const loginBtn = document.getElementById('manualLoginBtn');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('errorMessage');
        const errorText = document.getElementById('errorText');
        const debugToggle = document.getElementById('debugToggle');
        const debugInfo = document.getElementById('debugInfo');
        const currentUrlEl = document.getElementById('currentUrl');
        const widgetStatusEl = document.getElementById('widgetStatus');
        const storageStatusEl = document.getElementById('storageStatus');
        
        // ========== –û–¢–õ–ê–î–ö–ê ==========
        function initDebug() {
            currentUrlEl.textContent = window.location.href;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º Telegram Widget
            if (window.Telegram && Telegram.Login) {
                widgetStatusEl.textContent = '‚úÖ –î–æ—Å—Ç—É–ø–Ω–∏–π';
                widgetStatusEl.style.color = '#10B981';
            } else {
                widgetStatusEl.textContent = '‚ùå –ù–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
                widgetStatusEl.style.color = '#EF4444';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º localStorage
            const hasStorage = typeof localStorage !== 'undefined';
            storageStatusEl.textContent = hasStorage ? '‚úÖ –î–æ—Å—Ç—É–ø–Ω–∏–π' : '‚ùå –ù–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π';
            storageStatusEl.style.color = hasStorage ? '#10B981' : '#EF4444';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –æ—Ç–ª–∞–¥–∫—É
            debugToggle.addEventListener('click', function() {
                if (debugInfo.style.display === 'block') {
                    debugInfo.style.display = 'none';
                    debugToggle.textContent = '–ü–æ–∫–∞–∑–∞—Ç–∏ —Ç–µ—Ö–Ω—ñ—á–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é';
                } else {
                    debugInfo.style.display = 'block';
                    debugToggle.textContent = '–°—Ö–æ–≤–∞—Ç–∏ —Ç–µ—Ö–Ω—ñ—á–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é';
                }
            });
        }
        
        // ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö T–ï–õ–ï–ì–†–ê–ú ==========
        function onTelegramAuth(user) {
            console.log('‚úÖ Telegram Widget –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:', user);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
            loginBtn.style.display = 'none';
            loading.style.display = 'flex';
            errorMessage.style.display = 'none';
            
            try {
                // 1. –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage
                const userData = {
                    id: user.id.toString(),
                    first_name: user.first_name || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á',
                    username: user.username || '',
                    auth_date: user.auth_date || Math.floor(Date.now() / 1000),
                    hash: user.hash || '',
                    source: 'telegram_widget'
                };
                
                localStorage.setItem('telegram_user', JSON.stringify(userData));
                localStorage.setItem('auth_time', Date.now().toString());
                
                console.log('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage:', userData.first_name);
                
                // 2. –§–æ—Ä–º–∏—Ä—É–µ–º URL –¥–ª—è auth-handler.html
                const params = new URLSearchParams({
                    user_id: user.id,
                    user_name: encodeURIComponent(user.first_name || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'),
                    user_login: user.username || '',
                    auth_date: user.auth_date || Math.floor(Date.now() / 1000)
                });
                
                // 3. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ auth-handler.html
                setTimeout(() => {
                    window.location.href = `auth-handler.html?${params.toString()}`;
                }, 500);
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
                showError('–ü–æ–º–∏–ª–∫–∞ –æ–±—Ä–æ–±–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó');
                loginBtn.style.display = 'flex';
                loading.style.display = 'none';
            }
        }
        
        // –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ
        window.onTelegramAuth = onTelegramAuth;
        
        // ========== –†–£–ß–ù–ê–Ø –ö–ù–û–ü–ö–ê ==========
        loginBtn.addEventListener('click', function() {
            console.log('üîÑ –ó–∞–ø—É—Å–∫ Telegram Widget...');
            
            // –ü—ã—Ç–∞–µ–º—Å—è –≤—ã–∑–≤–∞—Ç—å –≤–∏–¥–∂–µ—Ç
            if (window.Telegram && Telegram.Login && Telegram.Login.auth) {
                Telegram.Login.auth({bot_id: BOT_USERNAME, request_access: true}, function(user) {
                    if (user) {
                        onTelegramAuth(user);
                    } else {
                        showError('–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é —Å–∫–∞—Å–æ–≤–∞–Ω–æ');
                    }
                });
            } else {
                showError('Telegram Widget –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏–≤—Å—è. –°–ø—Ä–æ–±—É–π—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É.');
            }
        });
        
        // ========== –£–¢–ò–õ–ò–¢–´ ==========
        function showError(message) {
            errorText.textContent = message;
            errorMessage.style.display = 'flex';
            loading.style.display = 'none';
            loginBtn.style.display = 'flex';
        }
        
        function clearLocalStorage() {
            localStorage.clear();
            storageStatusEl.textContent = '‚úÖ –û—á–∏—â–µ–Ω–æ';
            alert('LocalStorage –æ—á–∏—â–µ–Ω–æ!');
        }
        
        // ========== –ü–†–û–í–ï–†–ö–ê –°–£–©–ï–°–¢–í–£–Æ–©–ï–ô –°–ï–°–°–ò–ò ==========
        function checkExistingSession() {
            console.log('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–µ—Å—Å–∏–∏...');
            
            const savedUser = localStorage.getItem('telegram_user');
            const authTime = localStorage.getItem('auth_time');
            
            if (savedUser && authTime) {
                const userData = JSON.parse(savedUser);
                const timeDiff = Date.now() - parseInt(authTime);
                
                // –ï—Å–ª–∏ —Å–µ—Å—Å–∏—è –∞–∫—Ç–∏–≤–Ω–∞ (–º–µ–Ω–µ–µ 24 —á–∞—Å–æ–≤)
                if (timeDiff < 86400000) {
                    console.log('‚úÖ –ù–∞–π–¥–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è:', userData.first_name);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    checkUserStatus(userData.id, userData.first_name);
                    return true;
                } else {
                    console.log('‚ùå –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞');
                    localStorage.clear();
                }
            }
            
            return false;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Firebase
        async function checkUserStatus(userId, userName) {
            try {
                // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º Firebase —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ
                const { db } = await import('./firebase-app.js');
                const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js');
                
                const userDoc = await getDoc(doc(db, "users", userId));
                
                if (userDoc.exists()) {
                    const userData = userDoc.data();
                    
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –∏–ª–∏ —ç—Ç–æ –∞–¥–º–∏–Ω
                    if (userData.status === 'approved' || userId === ADMIN_ID) {
                        console.log('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –≤ index.html');
                        window.location.href = 'index.html';
                        return;
                    }
                }
                
                // –ï—Å–ª–∏ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –∏–ª–∏ –Ω–µ—Ç –≤ Firebase, –∏–¥—ë–º –Ω–∞ auth-handler
                console.log('‚ÑπÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ auth-handler');
                const params = new URLSearchParams({
                    user_id: userId,
                    user_name: encodeURIComponent(userName || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'),
                    auth_date: Date.now().toString().slice(0, -3)
                });
                
                window.location.href = `auth-handler.html?${params.toString()}`;
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞:', error);
                // –ï—Å–ª–∏ Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ —ç—Ç–æ –∞–¥–º–∏–Ω - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                if (userId === ADMIN_ID) {
                    console.log('‚ö†Ô∏è Firebase –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–æ —ç—Ç–æ –∞–¥–º–∏–Ω - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º');
                    window.location.href = 'index.html';
                }
            }
        }
        
        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ==========
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Ö–æ–¥–∞...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—Ç–ª–∞–¥–∫—É
            initDebug();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ—Å—Å–∏—é
            const hasSession = checkExistingSession();
            
            if (!hasSession) {
                console.log('‚ÑπÔ∏è –ê–∫—Ç–∏–≤–Ω–æ–π —Å–µ—Å—Å–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞');
                loginBtn.style.display = 'flex';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã URL (–Ω–∞ —Å–ª—É—á–∞–π callback –æ—Ç Telegram)
            const urlParams = new URLSearchParams(window.location.search);
            const hash = urlParams.get('hash');
            const tgUser = urlParams.get('user');
            
            if (hash || tgUser) {
                console.log('üì• –ü–æ–ª—É—á–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ—Ç Telegram');
                // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±—É–¥—É—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã –≤–∏–¥–∂–µ—Ç–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
            }
            
            console.log('‚úÖ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ –≥–æ—Ç–æ–≤–∞');
        });
    </script>
</body>
</html>
